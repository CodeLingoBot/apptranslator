<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link href="/s/css/bootstrap.css" rel="stylesheet">
    <link href="/s/css/bootstrap-responsive.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <style type=text/css>
    .trans {
        padding-top: 2px;
        padding-bottom: 2px;
    }
    .trans:hover {
        background-color: #fafafa;
    }
    .inline-progress {
        margin-bottom: -5px;
        display: inline-block;
    }
    </style>
</head>

<body>

<div class="container">
<header class="jumbotron subhead" id="overview">
    <h2><a href="/">Home</a> : <a href="/app/{{.App.Name}}">{{.App.Name}}</a> : strings
         <span style="font-size:50%;float:right;">{{if .User}}Logged in as {{.User}} (<a href="/logout?redirect={{.RedirectUrl}}">logout</a>){{else}}Not logged in. <a href="/login?redirect={{.RedirectUrl}}">Log in with Twitter</a>{{end}}</span>
    </h2>
    <div class="lead">
    {{.StringsCount}} active strings, {{len .DeletedStrings }} unused strings
    {{if not .User}}(log in to duplicate translations){{end}}</div>
</header>

<p style="margin-bottom:24px"></p>

{{$canDuplicate := .CanDuplicate}}

{{if len .Strings}}
    <b>{{len .Strings}} active strings:</b><br>
    {{range $idx, $el := .Strings}}
    <div class="trans" id="idTrans{{$idx}}">
        <span class="origstr">{{$el}}</span>
        {{if $canDuplicate}}
        <a href="#" class="dupbtn" id="idDup{{$idx}}">Duplicate translation...</a>
        {{end}}
    </div>
    {{end}}
{{end}}

{{if len .DeletedStrings}}
    <p></p>
    <b>{{len .DeletedStrings}} unused strings:<br></b>
    {{range $idx, $el := .DeletedStrings}}
    <div class="trans" id="idObsolete{{$idx}}">
        <span class="origstr">{{$el}}</span>
    </div>
    {{end}}
{{end}}

{{if .User}}
<div class="modal hide" id="idDupTrans">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3><span id="idDupTransHdr"></span></h3>
    </div>
    <div>
        <form class="well" action="/duptranslation" method="POST">
            <div class="modal-body">
                <label>Duplicate translation of string:</label>
                <textarea rows=3 readonly="readonly" name="string" id="idDupFormString" style="width:90%"></textarea>
                <label>As:</label>
                <textarea rows=3 name="duplicate" id="idDupFormTrans" style="width:90%"></textarea>
                <input type="hidden" name="app" value="{{.App.Name}}">
                <p id="mismatchedDupStringFormattingError" style="color:red;visibility:hidden"><bold>
                    Error: translation cannot be empty and string formatting directives (%s, %d etc.)
                    must be in the same order.
                </bold></p>
                <p></p>
                <p>Note: by adding/editing a translation you agree to place your translations
                into <a href="http://en.wikipedia.org/wiki/Public_domain">Public Domain</a>.</p>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Submit</button>
                <a href="#" class="btn" data-dismiss="modal">Cancel</a>
            </div>
        </form>
    </div>
</div>
{{else}}
<div class="modal hide" id="idDupTrans">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3><span id="idDupTransHdr"></span></h3>
    </div>
    <div>
        <form class="well" action="/nowhere" method="POST">
            <div class="modal-body">
                <p>You must be logged in to edit translations.
                <a href="/login?redirect={{.RedirectUrl}}">Log in with Twitter</a>.</p>

                <p>Note: by logging in you agree that your translations
                are placed into <a href="http://en.wikipedia.org/wiki/Public_domain">Public Domain</a>.</p>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal">Close</a>
            </div>
        </form>
    </div>
</div>
{{end}}

<hr style="margin:4px">
<center style="padding-bottom:12px"><a href="https://github.com/kjk/apptranslator">App Translator</a>, lovingly crafted by <a href="http://blog.kowalczyk.info">Krzysztof Kowalczyk<a></center>

<!-- placed at the end for faster loading -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="/s/js/bootstrap.js"></script>
<script src="/s/js/apptranslator.js"></script>

<script>

// 1. can't be the same
// 2. their string formatting instructions (%d, %s etc.) match
function canSubmitDuplication(text, translation) {
    var t = $.trim(translation);
    if (t.length == 0) { return false; }
    return stringFormattingModifiersAreSame(text, translation);
}

var prevDupValue = "";
function updateDupTransState() {
    var txt = $("#idDupFormString").text();
    prevDupValue = $("#idDupFormTrans").val();
    if (canSubmitDuplication(txt, prevDupValue)) {
        $("button[type=submit]").removeAttr("disabled");
        $("#mismatchedDupStringFormattingError").css({"visibility":"hidden"});
    } else {
        $("button[type=submit]").attr("disabled", "disabled");
        $("#mismatchedDupStringFormattingError").css({"visibility":"visible"});
    }
}

$(document).ready(function() {

    $(".dupbtn").click(function() {
        $("#idDupTransHdr").text("Duplicate translation");
        var el = $(this).parent().find(".origstr");
        $("#idDupFormString").text(el.text());
        $("#idDupFormTrans").text(el.text());
        $("#idDupTrans").modal('show');
        $("#idDupFormTrans").focus();
        updateDupTransState();
    });

    $("#idDupFormTrans").bind("keyup paste", function(e) {
        if ($(this).val() == prevDupValue) { return; }
        updateDupTransState();
    });

});

</script>

</body>
</html>
